<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <!-- Ø¨Ù‚ÛŒÙ‡ ØªÚ¯â€ŒÙ‡Ø§ÛŒ head Ù…Ø§Ù†Ù†Ø¯ Ù‚Ø¨Ù„ -->
</head>
<body>
    <!-- Ù…Ø­ØªÙˆØ§ÛŒ HTML Ù…Ø§Ù†Ù†Ø¯ Ù‚Ø¨Ù„ -->

    <script>
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ±
        const config = {
            eventTitle: "Ø±ÙˆØ² Ø¹ÛŒØ¯ ØºØ¯ÛŒØ±",
            eventDescription: "Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡ ØªØ§ Ø¹ÛŒØ¯ Ø³Ø¹ÛŒØ¯ ØºØ¯ÛŒØ± Ø®Ù…",
            targetDate: "2025-06-5T00:07:00",
            completedMessage: "ğŸ‰ Ø¹ÛŒØ¯ ØºØ¯ÛŒØ± Ù…Ø¨Ø§Ø±Ú©! ğŸ‰",
            notificationTitle: "ÙˆÙ‚Øª Ø´Ø§Ø¯ÛŒ Ø±Ø³ÛŒØ¯Ù‡ Ø§Ø³Øª!",
            notificationMessage: "Ø¹ÛŒØ¯ ØºØ¯ÛŒØ± Ø®Ù… ÙØ±Ø§ Ø±Ø³ÛŒØ¯Ù‡ Ø§Ø³Øª!",
            colors: {
                primary: "#4a148c",
                secondary: "#6a11cb",
                accent: "#ff416c"
            }
        };

        // Ø¹Ù†Ø§ØµØ± DOM
        const elements = {
            eventTitle: document.getElementById('event-title'),
            eventDescription: document.getElementById('event-description'),
            days: document.getElementById('days'),
            hours: document.getElementById('hours'),
            minutes: document.getElementById('minutes'),
            seconds: document.getElementById('seconds'),
            completed: document.getElementById('completed'),
            completedMessage: document.getElementById('completed-message'),
            notificationBtn: document.getElementById('notificationBtn')
        };

        // Ø§Ø¹Ù…Ø§Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        elements.eventTitle.textContent = config.eventTitle;
        elements.eventDescription.textContent = config.eventDescription;
        elements.completedMessage.textContent = config.completedMessage;

        // Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§
        let notificationPermission = false;

        function checkNotificationSupport() {
            if (!('Notification' in window)) {
                elements.notificationBtn.textContent = 'Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø² Ø§Ø¹Ù„Ø§Ù† Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯';
                elements.notificationBtn.disabled = true;
                return false;
            }
            return true;
        }

        function updateNotificationButton() {
            if (!checkNotificationSupport()) return;

            switch(Notification.permission) {
                case 'granted':
                    notificationPermission = true;
                    elements.notificationBtn.textContent = 'Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ ÙØ¹Ø§Ù„ Ù‡Ø³ØªÙ†Ø¯';
                    elements.notificationBtn.disabled = true;
                    break;
                case 'denied':
                    elements.notificationBtn.textContent = 'Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯';
                    elements.notificationBtn.disabled = true;
                    break;
                default:
                    elements.notificationBtn.textContent = 'ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§';
                    elements.notificationBtn.disabled = false;
            }
        }

        async function requestNotificationPermission() {
            if (!checkNotificationSupport()) return;

            try {
                const permission = await Notification.requestPermission();
                
                if (permission === 'granted') {
                    notificationPermission = true;
                    sendTestNotification('Ø§Ø¹Ù„Ø§Ù† ÙØ¹Ø§Ù„ Ø´Ø¯', 'ÙˆÙ‚ØªÛŒ Ø²Ù…Ø§Ù† Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø±Ø³Ø¯ Ø¨Ù‡ Ø´Ù…Ø§ Ø§Ø·Ù„Ø§Ø¹ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.');
                }
                
                updateNotificationButton();
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬ÙˆØ² Ø§Ø¹Ù„Ø§Ù†:', error);
                elements.notificationBtn.textContent = 'Ø®Ø·Ø§ Ø¯Ø± ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¹Ù„Ø§Ù†';
            }
        }

        function sendTestNotification(title, body) {
            if (!notificationPermission) return;
            
            try {
                if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                    navigator.serviceWorker.ready.then(registration => {
                        registration.showNotification(title, {
                            body: body,
                            vibrate: [200, 100, 200]
                        });
                    });
                } else {
                    new Notification(title, { body: body });
                }
            } catch (e) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø¹Ù„Ø§Ù†:', e);
            }
        }

        function sendFinalNotification() {
            if (!notificationPermission) return;
            
            try {
                const options = {
                    body: config.notificationMessage,
                    vibrate: [200, 100, 200, 100, 200],
                    icon: '/icon.png' // Ù…Ø³ÛŒØ± Ø¢ÛŒÚ©ÙˆÙ† Ø±Ø§ Ø§ØµÙ„Ø§Ø­ Ú©Ù†ÛŒØ¯
                };
                
                if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                    navigator.serviceWorker.ready.then(registration => {
                        registration.showNotification(config.notificationTitle, options);
                    });
                } else {
                    new Notification(config.notificationTitle, options);
                }
            } catch (e) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø¹Ù„Ø§Ù† Ù†Ù‡Ø§ÛŒÛŒ:', e);
            }
        }

        // Ø´Ù…Ø§Ø±Ø´Ú¯Ø± Ù…Ø¹Ú©ÙˆØ³ (Ù…Ø§Ù†Ù†Ø¯ Ù‚Ø¨Ù„)
        function updateCountdown() {
            const targetDate = new Date(config.targetDate);
            const now = new Date();
            const diff = targetDate - now;

            if (diff <= 0) {
                clearInterval(countdownInterval);
                // ... Ú©Ø¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… ØªÚ©Ù…ÛŒÙ„
                sendFinalNotification();
                return;
            }

            // ... Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡
        }

        // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
        elements.notificationBtn.addEventListener('click', requestNotificationPermission);

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        updateNotificationButton();
        const countdownInterval = setInterval(updateCountdown, 1000);
        updateCountdown();

        // Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯');
                }).catch(error => {
                    console.log('Ø«Ø¨Øª ServiceWorker Ù†Ø§Ù…ÙˆÙÙ‚:', error);
                });
            });
        }
    </script>
</body>
</html>
