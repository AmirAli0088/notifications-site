<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <!-- بقیه تگ‌های head مانند قبل -->
</head>
<body>
    <!-- محتوای HTML مانند قبل -->

    <script>
        // تنظیمات قابل تغییر
        const config = {
            eventTitle: "روز عید غدیر",
            eventDescription: "زمان باقی مانده تا عید سعید غدیر خم",
            targetDate: "2025-06-5T00:07:00",
            completedMessage: "🎉 عید غدیر مبارک! 🎉",
            notificationTitle: "وقت شادی رسیده است!",
            notificationMessage: "عید غدیر خم فرا رسیده است!",
            colors: {
                primary: "#4a148c",
                secondary: "#6a11cb",
                accent: "#ff416c"
            }
        };

        // عناصر DOM
        const elements = {
            eventTitle: document.getElementById('event-title'),
            eventDescription: document.getElementById('event-description'),
            days: document.getElementById('days'),
            hours: document.getElementById('hours'),
            minutes: document.getElementById('minutes'),
            seconds: document.getElementById('seconds'),
            completed: document.getElementById('completed'),
            completedMessage: document.getElementById('completed-message'),
            notificationBtn: document.getElementById('notificationBtn')
        };

        // اعمال تنظیمات
        elements.eventTitle.textContent = config.eventTitle;
        elements.eventDescription.textContent = config.eventDescription;
        elements.completedMessage.textContent = config.completedMessage;

        // مدیریت اعلان‌ها
        let notificationPermission = false;

        function checkNotificationSupport() {
            if (!('Notification' in window)) {
                elements.notificationBtn.textContent = 'مرورگر از اعلان پشتیبانی نمی‌کند';
                elements.notificationBtn.disabled = true;
                return false;
            }
            return true;
        }

        function updateNotificationButton() {
            if (!checkNotificationSupport()) return;

            switch(Notification.permission) {
                case 'granted':
                    notificationPermission = true;
                    elements.notificationBtn.textContent = 'اعلان‌ها فعال هستند';
                    elements.notificationBtn.disabled = true;
                    break;
                case 'denied':
                    elements.notificationBtn.textContent = 'اعلان‌ها مسدود شده‌اند';
                    elements.notificationBtn.disabled = true;
                    break;
                default:
                    elements.notificationBtn.textContent = 'فعال کردن اعلان‌ها';
                    elements.notificationBtn.disabled = false;
            }
        }

        async function requestNotificationPermission() {
            if (!checkNotificationSupport()) return;

            try {
                const permission = await Notification.requestPermission();
                
                if (permission === 'granted') {
                    notificationPermission = true;
                    sendTestNotification('اعلان فعال شد', 'وقتی زمان به پایان برسد به شما اطلاع داده می‌شود.');
                }
                
                updateNotificationButton();
            } catch (error) {
                console.error('خطا در درخواست مجوز اعلان:', error);
                elements.notificationBtn.textContent = 'خطا در فعال‌سازی اعلان';
            }
        }

        function sendTestNotification(title, body) {
            if (!notificationPermission) return;
            
            try {
                if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                    navigator.serviceWorker.ready.then(registration => {
                        registration.showNotification(title, {
                            body: body,
                            vibrate: [200, 100, 200]
                        });
                    });
                } else {
                    new Notification(title, { body: body });
                }
            } catch (e) {
                console.error('خطا در ارسال اعلان:', e);
            }
        }

        function sendFinalNotification() {
            if (!notificationPermission) return;
            
            try {
                const options = {
                    body: config.notificationMessage,
                    vibrate: [200, 100, 200, 100, 200],
                    icon: '/icon.png' // مسیر آیکون را اصلاح کنید
                };
                
                if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                    navigator.serviceWorker.ready.then(registration => {
                        registration.showNotification(config.notificationTitle, options);
                    });
                } else {
                    new Notification(config.notificationTitle, options);
                }
            } catch (e) {
                console.error('خطا در ارسال اعلان نهایی:', e);
            }
        }

        // شمارشگر معکوس (مانند قبل)
        function updateCountdown() {
            const targetDate = new Date(config.targetDate);
            const now = new Date();
            const diff = targetDate - now;

            if (diff <= 0) {
                clearInterval(countdownInterval);
                // ... کدهای قبلی نمایش پیام تکمیل
                sendFinalNotification();
                return;
            }

            // ... محاسبات زمان باقی‌مانده
        }

        // رویدادها
        elements.notificationBtn.addEventListener('click', requestNotificationPermission);

        // مقداردهی اولیه
        updateNotificationButton();
        const countdownInterval = setInterval(updateCountdown, 1000);
        updateCountdown();

        // Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker با موفقیت ثبت شد');
                }).catch(error => {
                    console.log('ثبت ServiceWorker ناموفق:', error);
                });
            });
        }
    </script>
</body>
</html>
